@using BarnamenevisanCompany.Application.Extensions
@using BarnamenevisanCompany.Application.Statics
@using BarnamenevisanCompany.Domain.Enums.Order
@using BarnamenevisanCompany.Domain.ViewModels.Admin.Order
@using BarnamenevisanCompany.Web.Extensions
@using BarnamenevisanCompany.Web.Helpers.TagHelpers
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model BarnamenevisanCompany.Domain.ViewModels.Admin.Order.AdminOrderDetailsViewModel

@{
  ViewData["Title"] = "جزئیات سفارش";
  var referer = Context.Request.GetUrlReferer();
}

@section Breadcrumb

{
  <admin-breadcrumb page-title="@ViewData["Title"]">
    <admin-breadcrumb-item asp-area="Admin" asp-controller="Order" asp-action="List">لیست سفارشات
    </admin-breadcrumb-item>
    <admin-breadcrumb-item last-active-item="true">@ViewData["Title"]</admin-breadcrumb-item>
  </admin-breadcrumb>
}

<div class="card">
  <div class="form-body">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="Title"></label>
            <div class="col-md-9">
              <p class="form-control-static">@Model.Title</p>
            </div>
          </div>
        </div>
        <!--/span-->
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="OrderNumber"></label>
            <div class="col-md-9">
              <p class="form-control-static">@Model.OrderNumber</p>
            </div>
          </div>
        </div>
        <!--/span-->
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="CustomerName"></label>
            <div class="col-md-9">
              <p class="form-control-static">@Model.CustomerName</p>
            </div>
          </div>
        </div>
        <!--/span-->
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="CustomerMobile"></label>
            <div class="col-md-9">
              <p class="form-control-static">@Model.CustomerMobile</p>
            </div>
          </div>
        </div>
        <!--/span-->
      </div>
      <!--/row-->
      <div class="row">
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="OrderDate"></label>
            <div class="col-md-9">
              <p class="form-control-static">@Model.OrderDate.ToShamsi()</p>
            </div>
          </div>
        </div>
        <!--/span-->
        <div class="col-md-6">
          <div class="form-group row">
            <label class="form-label col-md-3" asp-for="OrderStatus"></label>
            <div class="col-md-4">
              <form asp-area="Admin"
                    asp-controller="Order"
                    asp-action="UpdateStatus"
                    asp-ajax="true"
                    asp-ajax-method="Post"
                    asp-ajax-failure="onUpdateOrderStatusFailure();"
                    asp-ajax-success="onUpdateOrderStatusSuccess(),onAjaxSuccess(data, status, xhr);"
                    asp-ajax-reinitialize="false"
                    class="floating-labels form-horizontal">
                <input name="orderId" value="@Model.Id" type="hidden"/>
                <select class="form-control form-select" name="status" id="OrderStatus">
                  @foreach (var item in Enum.GetValues<OrderStatus>())
                  {
                    if (Model.OrderStatus == item)
                    {
                      <option value="@item" selected="selected">@item.GetEnumName()</option>
                    }
                    else
                    {
                      <option value="@item">@item.GetEnumName()</option>
                    }
                  }
                </select>
              </form>
              <span class="bar"></span>
            </div>
          </div>
        </div>
        <!--/span-->
      </div>
      <!--/row-->
    </div>
    <hr class="m-0 border"/>
    <div class="card-body">
      <div class="row">
        <div class="col-md-12">
          <div class="form-group row">
            <label class="form-label col-md-1" asp-for="OrderTypes"></label>
            <div class="col-md-11">
              <div class="row">
                @foreach (var type in Model.OrderTypes)
                {
                  <div class="col-md-4 col-xxl-2">
                    <div class="text-center alert-dismissible fade p-0 show alert card-hover" role="alert">
                      <div class="card shadow border">
                        <div class="card-body p-0">
                          <div class="p-2 d-block mt-3">
                            <img src="@FilePaths.OrderTypeOriginalImage@(!type.ImageUrl.IsNullOrEmptyOrWhiteSpace() ? type.ImageUrl : SiteTools.DefaultImageName)"
                                 width="100" height="100" class="rounded" alt="@type.Title"/>
                            <h6 class="mt-3 mb-3">@type.Title</h6>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group row">
            <label class="form-label col-md-1" asp-for="Description"></label>
            <div class="col-md-11">
              <p class="form-control-static">
                @Model.Description
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <!--/span-->
        @if (Model.Attachment is not null)
        {
          <div class="col-md-12">
            <div class="form-group row">
              <label class="form-label col-md-1" asp-for="Attachment"></label>
              <div class="col-md-1">
                <a download
                  class="btn form-control-static justify-content-center w-100 btn mb-1 btn-outline-info d-flex align-items-center"
                  href="@(FilePaths.OrderAttachment + Model.Attachment)">
                  دانلود
                </a>
              </div>
            </div>
          </div>
        }
        <!--/span-->
      </div>
    </div>
    <hr class="m-0 border"/>
    <partial name="_AnswerToOrderPartial.cshtml"
             model="new AdminAnswerToOrderViewModel() { Answer = Model.Answer, OrderId = Model.Id }"/>
    <div class="form-actions border-top">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="row">
              <div class="col-md-offset-3 col-md-9">
                <a
                  href="@(!referer.IsNullOrEmptyOrWhiteSpace() ? referer : Url.Action("List", "ContactUs", new { area = "Admin", page = ViewBag.Page }))"
                  class="btn btn-danger ms-6">بازگشت</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
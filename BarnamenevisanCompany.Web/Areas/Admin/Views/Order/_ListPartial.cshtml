@using BarnamenevisanCompany.Application.Extensions
@using BarnamenevisanCompany.Domain.Enums.Order
@using BarnamenevisanCompany.Infra.Data.Statics
@using BarnamenevisanCompany.Web.Helpers.TagHelpers
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model BarnamenevisanCompany.Domain.ViewModels.Admin.Order.AdminFilterOrderViewModel

<form asp-area="Admin"
      asp-controller="Order"
      asp-action="ListPartial"
      asp-ajax="true"
      asp-ajax-update="#orders"
      id="@Model.FormId">
    <input asp-for="Page" type="hidden"/>
    <input asp-for="UserId" type="hidden"/>
    <input asp-for="FormId" type="hidden"/>
</form>


<div class="card" id="orders">
    <div class="card-body">
        @if (Model.Entities is not null && Model.Entities.Any())
        {
            <div class="table-responsive mb-4 border rounded-1">

                <table class="table text-nowrap mb-0 align-middle">

                    <thead>
                    <tr>
                        <th>
                            <h6 class="fs-4 fw-semibold mb-0">عنوان</h6>
                        </th>
                        <th>
                            <h6 class="fs-4 fw-semibold mb-0">تاریخ ایجاد</h6>
                        </th>
                        <th>
                            <h6 class="fs-4 fw-semibold mb-0">وضعیت</h6>
                        </th>
                        <th>
                            <h6 class="fs-4 fw-semibold mb-0">عملیات</h6>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.Entities)
                    {
                        <tr>
                            <td>
                                <p class="mb-0 fw-normal fs-4">@item.Title</p>
                            </td>
                            <td>
                                <p class="mb-0 fw-normal fs-4">@item.OrderDate.ToShamsiDateTime()</p>
                            </td>
                            <td>
                                @switch (item.OrderStatus)
                                {
                                    case OrderStatus.InProgress:
                                        <span class="badge bg-warning-subtle text-warning">@item.OrderStatus.GetEnumName()</span>
                                        break;
                                    case OrderStatus.Done:
                                        <span class="badge bg-success-subtle text-success">@item.OrderStatus.GetEnumName()</span>
                                        break;
                                    case OrderStatus.Rejected:
                                        <span class="badge bg-danger-subtle text-danger">@item.OrderStatus.GetEnumName()</span>
                                        break;
                                }
                            </td>
                            <td>
                                <a invoke-permission="@PermissionsName.AnswerToOrder"
                                   asp-area="Admin"
                                   asp-controller="Order"
                                   asp-action="Details"
                                   asp-route-id="@item.Id"
                                   asp-route-page="@Model.Page"
                                   class="text-info removeAfterDelete @(item.IsDeleted ? "d-none" : "")"
                                   title="مشاهده و پاسخ ">
                                    <iconify-icon icon="fluent:eye-28-regular" width="22" height="22"></iconify-icon>
                                </a>
                                @if (item.IsDeleted)
                                {
                                    <a invoke-permission="@PermissionsName.DeleteOrRecoverOrder" class="text-info"
                                       onclick="ConfirmRecover(this, '@Url.Action("DeleteOrRecover", "Order", new { area = "Admin", id = item.Id })')" title="بازگردانی">
                                        <iconify-icon icon="solar:undo-left-round-outline" width="22" height="22"></iconify-icon>
                                    </a>
                                }
                                else
                                {
                                    <a invoke-permission="@PermissionsName.DeleteOrRecoverOrder" class="text-danger"
                                       onclick="ConfirmDelete(this, '@Url.Action("DeleteOrRecover", "Order", new { area = "Admin", id = item.Id })')" title="حذف">
                                        <iconify-icon icon="solar:trash-bin-trash-outline" width="22" height="22"></iconify-icon>
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
            <partial name="~/Areas/Admin/Views/Shared/_PagingPartial.cshtml" model="@Model.GetCurrentPaging()"/>
        }
        else
        {
            <partial name="_NotFoundPartial"/>
        }
    </div>
</div>